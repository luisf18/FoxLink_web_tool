<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cards com Widgets</title>

<style>
    body {
        margin: 0;
        padding: 20px;
        background: #f2f2f2;
        font-family: Arial, Helvetica, sans-serif;
    }

    /* ===== GRID ===== */
    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 20px;
    }

    /* ===== CARD ===== */
    .card {
        background: #fff;
        border-radius: 16px;
        height: 420px;
        display: flex;
        flex-direction: column;
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        overflow: hidden;
    }

    .card-header {
        padding: 12px 16px;
        background: #2c3e50;
        color: #fff;
        font-weight: bold;
        flex-shrink: 0;
    }

    .card-body {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
    }

    /* ===== WIDGET BASE ===== */
    .widget {
        background: #f7f7f7;
        border-radius: 10px;
        padding: 8px;
        margin-bottom: 8px;
        font-size: 14px;
    }

    .widget-row {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }

    .widget-name {
        min-width: 80px;
        font-weight: bold;
    }

    .real-value {
        font-size: 13px;
        color: #888;
        min-width: 36px;
        text-align: right;
    }

    .status {
        font-size: 13px;
        color: green;
    }

    /* ===== INPUTS ===== */
    input[type="number"] { width: 70px; }
    input[type="text"]   { flex: 1; min-width: 120px; }
    input[type="range"]  { flex: 1; }

    /* ===== CHECKBOX GROUP ===== */
    .checkbox-group {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }

    .checkbox-group label {
        font-size: 12px;
        background: #e0e0e0;
        padding: 3px 6px;
        border-radius: 6px;
        cursor: pointer;
    }

    /* ===== FOOTER ===== */
    .card-footer {
        padding: 10px;
        display: flex;
        gap: 6px;
        background: #fafafa;
        flex-shrink: 0;
    }

    .card-footer button {
        flex: 1;
        padding: 7px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 12px;
    }

    .checkbox-group-vertical {
        margin-top: 6px;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .checkbox-group-vertical label {
        font-size: 12px;
        background: #e6e6e6;
        padding: 4px 8px;
        border-radius: 6px;
        cursor: pointer;
    }


    

    .widget-row {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* empurra tudo pra direita */
    .widget-right {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .real-value {
        font-size: 14px;
        color: #777;
    }

    .status {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #dc3545;
    }

    .status.ok {
        background: #28a745;
    }

    /* MUDANÃ‡A 2 */

    .widget-row {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: nowrap;   /* ðŸ”‘ impede quebra */
    }

    /* nome */
    .widget-name {
        font-weight: 600;
        min-width: 50px;
    }

    /* valor abstrato (colado no nome) */
    .abstract-value {
        font-size: 14px;
        color: #666;
        min-width: 40px;
    }

    /* slider NÃƒO pode ser 100% */
    .widget-row input[type="range"] {
        flex: 1;              /* ocupa sÃ³ o espaÃ§o restante */
        min-width: 80px;
    }

    /* byte + ok sempre Ã  direita */
    .widget-right {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-left: auto;
    }

    /* byte discreto */
    .real-value {
        font-size: 14px;
        color: #777;
        min-width: 36px;
        text-align: center;
    }

    /* status */
    .status {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #dc3545;
    }

    .status.ok {
        background: #28a745;
    }



    .real-input {
        width: 48px;
        font-size: 11px;
        display: none;
    }

    .real-value.editable {
        cursor: pointer;
    }


    .real-value.abs {
        min-width: 48px;
        text-align: right;
        font-size: 12px;
        color: #666;
    }

    .abs-input {
        width: 52px;
        font-size: 11px;
        display: none;
    }


    .btn-clear  { background: #e74c3c; color: #fff; }
    .btn-text   { background: #3498db; color: #fff; }
    .btn-int    { background: #2ecc71; color: #fff; }
    .btn-slide  { background: #9b59b6; color: #fff; }
    .btn-string { background: #f39c12; color: #fff; }
    .btn-check  { background: #34495e; color: #fff; }
</style>
</head>
<body>

<div class="card-grid">

    <div class="card">
        <div class="card-header">Card A</div>
        <div class="card-body"></div>
        <div class="card-footer">
            <button class="btn-clear">Apagar</button>
            <button class="btn-text">Texto</button>
            <button class="btn-int">Int</button>
            <button class="btn-slide">Slide</button>
            <button class="btn-string">String</button>
            <button class="btn-check">Check</button>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Card B</div>
        <div class="card-body"></div>
        <div class="card-footer">
            <button class="btn-clear">Apagar</button>
            <button class="btn-text">Texto</button>
            <button class="btn-int">Int</button>
            <button class="btn-slide">Slide</button>
            <button class="btn-string">String</button>
            <button class="btn-check">Check</button>
        </div>
    </div>

</div>

<script>
function clamp(v) {
    return Math.max(0, Math.min(255, v));
}

function updateReal(el, v) {
    el.textContent = `[${clamp(v)}]`;
}

function abstractValue(byte) {
    return 5 * byte + 860;
}

function makeEditable(span, input, onCommit) {

    span.onclick = () => {
        const n = parseInt(span.textContent.replace(/\D/g, '')) || 0;
        input.value = n;
        span.style.display = 'none';
        input.style.display = 'inline-block';
        input.focus();
        input.select();
    };

    function commit() {
        let v = parseInt(input.value);
        if (isNaN(v)) v = 0;

        onCommit(v);   // ðŸ”‘ quem chama cuida do texto

        input.style.display = 'none';
        span.style.display = 'inline';
    }

    input.onblur = commit;

    input.onkeydown = (e) => {
        if (e.key === 'Enter') commit();
        if (e.key === 'Escape') {
            input.style.display = 'none';
            span.style.display = 'inline';
        }
    };
}


document.querySelectorAll('.card').forEach(card => {
    const body = card.querySelector('.card-body');

    card.querySelector('.btn-clear').onclick = () => body.innerHTML = "";

    // TEXTO
    card.querySelector('.btn-text').onclick = () => {
        const w = document.createElement('div');
        w.className = 'widget';
        w.textContent = "Texto gerado em " + new Date().toLocaleTimeString();
        body.appendChild(w);
    };

    // INT
    card.querySelector('.btn-int').onclick = () => {
        const w = document.createElement('div');
        w.className = 'widget';
        w.innerHTML = `
            <div class="widget-row">
                <span class="widget-name">int</span>
                <input type="number" value="0">
                <div class="widget-right">
                    <span class="real-value">[0]</span>
                    <span class="status ok"></span>
                </div>
            </div>`;
        const input = w.querySelector('input');
        const real = w.querySelector('.real-value');
        input.oninput = () => updateReal(real, input.value);
        body.appendChild(w);
    };

    // SLIDE
    card.querySelector('.btn-slide').onclick = () => {
        const w = document.createElement('div');
        w.className = 'widget';

        w.innerHTML = `
            <div class="widget-row slide-row">
                <span class="widget-name">slide</span>

                <span class="real-value abs editable">1600</span>
                <input class="abs-input" type="number">

                <input class="slide-input" type="range" min="0" max="255" value="148">

                <div class="widget-right">
                    <span class="real-value editable">[148]</span>
                    <input class="real-input" type="number" min="0" max="255" value="148">
                    <span class="status ok"></span>
                </div>
            </div>
        `;

        const slider   = w.querySelector('.slide-input');

        const byteSpan = w.querySelector('.real-value.editable:not(.abs)');
        const byteInp  = w.querySelector('.real-input');

        const absSpan  = w.querySelector('.real-value.abs');
        const absInp   = w.querySelector('.abs-input');

        function setFromByte(v) {
            v = clamp(v);
            slider.value = v;
            byteSpan.textContent = `[${v}]`;
            byteInp.value = v;
            absSpan.textContent = abstractValue(v);
        }

        function setFromAbstract(a) {
            let v = Math.round((a - 860) / 5);
            setFromByte(v);
            absSpan.textContent = a; // ðŸ”‘ mantÃ©m o valor abstrato correto
        }

        slider.oninput = () => setFromByte(slider.value);

        makeEditable(byteSpan, byteInp, (v) => {
            setFromByte(v);
        });

        makeEditable(absSpan, absInp, (a) => {
            setFromAbstract(a);
        });

        setFromByte(148);

        body.appendChild(w);
    };

    // STRING
    card.querySelector('.btn-string').onclick = () => {
        const w = document.createElement('div');
        w.className = 'widget';
        w.innerHTML = `
            <div class="widget-row">
                <span class="widget-name">string</span>
                <input type="text" placeholder="texto...">
                <span class="real-value">[0]</span>
                <span class="status">ok</span>
            </div>`;
        const input = w.querySelector('input');
        const real = w.querySelector('.real-value');
        input.oninput = () => updateReal(real, input.value.length);
        body.appendChild(w);
    };

    // CHECKBOX (bitmask)
    card.querySelector('.btn-check').onclick = () => {
        const w = document.createElement('div');
        w.className = 'widget';

        w.innerHTML = `
            <div class="widget-row">
                <span class="widget-name">flags</span>
                <div class="widget-right">
                    <span class="real-value">[0]</span>
                    <span class="status ok"></span>
                </div>
            </div>

            <div class="checkbox-group-vertical">
                <label><input type="checkbox" data-bit="0"> OP1</label>
                <label><input type="checkbox" data-bit="1"> OP2</label>
                <label><input type="checkbox" data-bit="2"> OP3</label>
                <label><input type="checkbox" data-bit="3"> OP4</label>
            </div>
        `;

        const real = w.querySelector('.real-value');

        w.querySelectorAll('input[type=checkbox]').forEach(cb => {
            cb.onchange = () => {
                let v = 0;
                w.querySelectorAll('input:checked').forEach(c => {
                    v |= (1 << c.dataset.bit);
                });
                updateReal(real, v);
            };
        });

        body.appendChild(w);
    };

});


</script>

</body>
</html>
